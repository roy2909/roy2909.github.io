<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/rahul_logo.png">

<title>Using Machine Learning to Identify Individual Ants | Rahul Roy</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Using Machine Learning to Identify Individual Ants | Rahul Roy’s Portfolio</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Using Machine Learning to Identify Individual Ants" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Machine Learning, Python, Computer Vision, OpenCV, PyTorch, C++" />
<meta property="og:description" content="Machine Learning, Python, Computer Vision, OpenCV, PyTorch, C++" />
<link rel="canonical" href="http://localhost:4000/antID/" />
<meta property="og:url" content="http://localhost:4000/antID/" />
<meta property="og:site_name" content="Rahul Roy’s Portfolio" />
<meta property="og:image" content="http://localhost:4000/assets/images/slower_bigger_ant.gif" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-10T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/slower_bigger_ant.gif" />
<meta property="twitter:title" content="Using Machine Learning to Identify Individual Ants" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-10T00:00:00-05:00","datePublished":"2023-08-10T00:00:00-05:00","description":"Machine Learning, Python, Computer Vision, OpenCV, PyTorch, C++","headline":"Using Machine Learning to Identify Individual Ants","image":"http://localhost:4000/assets/images/slower_bigger_ant.gif","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/antID/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/robotics.png"}},"url":"http://localhost:4000/antID/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/robotics.png" alt="Rahul Roy">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Projects</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/JamesOubre_Resume">Resume</a>
                </li>
                <a class="nav-link" href="/AboutMe">About</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Rahul Roy</h1>
    <p class="lead">
        Northwestern MS in Robotics
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                

                <!-- Post Title -->
                <h1 class="posttitle">Using Machine Learning to Identify Individual Ants</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>Machine Learning, Python, Computer Vision, OpenCV, PyTorch, C++</p>

<div align="center"><iframe width="700" height="394" src="https://www.youtube.com/embed/KltiiPcd1nc?si=WuJL2qU8SzZCvGjD" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></div>

<h2 id="overview">Overview</h2>
<p>The goal of this project was to create a system that could identify individual ants in a colony. Using
a machine vision camera equipped with a macro lens, I was able to collect 27,244 images
of 55 different harvester ants. These images were then used to train a machine learning
network to create a feature vector, or embedding, to describe each ant. By comparing embeddings of two
ants, a threshold could be used to determine if the ants are the same or different with and accuracy 
of 86.04%.</p>

<div align="center"><h2> <a href="https://github.com/oubrejames/antID">View it on Github</a></h2></div>

<h3 id="why-ants">Why Ants?</h3>
<p>The first reaction when I tell people about this project is typically something along the lines of “how
is this useful?” or “why would you want to do that?”. The answer is that for most people, it’s not
useful at all. However, for myrmecologists (ant scientists), it is very useful. Ants are very social 
insects that are commonly used to study social behavior and can be used to learn more about how swarms
of robots can be used to accomplish tasks. The current way of tracking individual ants in a colony is
an extremely tedious process that involves manually labeling each ant in a colony by painting different
patterns on them. Check out <a href="https://youtu.be/uAQ5IKVpysc">this video</a> to see exactly how tedious
this process can be. By creating a system that can automatically identify individual ants, we can save researchers a lot of time and effort.</p>

<h2 id="project-setup-and-hardware">Project Setup and Hardware</h2>
<p>To collect images of the ants, I used a Blackfly S camera from FLIR equipped with a macro lens. The 
camera was mounted on a microscope stand and placed above a 3D printed channel that the ants could
walk through. By using this setup, the ants were forced to walk in a straight line in the camera’s
field of view. This entire setup was then placed inside of a light box to ensure consistent lighting.</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/a5261545-e3ca-49aa-b72d-d54e64cbcd73" height="500" width="350" />  <img src="https://github.com/oubrejames/antID/assets/46512429/76fbd53c-77db-4546-b986-dc568ce16fc8" height="500" width="350" /></p>

<p>The image below shows the entire setup. There were two main living chambers for the ants. One for ants
that data had already been collected for and one for ants that data still needed to be imaged. There are
also multiple 3D printed gates to control the flow of ants from the living chambers to the data collection
area.</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/cb99713f-b1f7-4a37-87c9-7e023232fd85" height="800" width="700" /></p>
<p align="center">Setup Overview</p>

<h2 id="data-collection">Data Collection</h2>

<p>By using the setup described above, I was able to I was able to collect 27,244 images
of 55 different harvester ants. The traffic control gates were used to isolated one ant in the data collection area. This allowed me to collect a videos of one ant at a time.</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/d097f72f-aad7-4b84-8c3f-167528621f12" height="250" width="500" /></p>
<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/9589a8a1-cd86-46d3-8b16-473048150340" height="250" width="600" /></p>
<p align="center">Ant Imaging Channel and Image</p>

<p>To interact with the Blackfly camera and collect videos of the ants walking through the imaging channel, I 
had to first create a <a href="https://github.com/oubrejames/antID/tree/main/black_fly_tools">library in C++</a>
to interface with the camera. It allowed me to control all of the camera’s settings and collect videos. I also created 
a scripts to semi-automatically collect videos of the ants.</p>

<p>When collecting videos, I would first let an ant walk into the data collection area and then start recording. Once the ant walked under the camera enough, I would stop recording and have the ant walk to the separate living chamber. I would then repeat this process for each unfilmed ant. Videos were named sequentially as “ant_#.avi” so that I could keep track of which ant was in each video.</p>

<h2 id="methodology">Methodology</h2>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/c10ccb0f-a427-44be-b271-7a9c534163ca" /></p>
<p align="center">System Pipeline</p>

<p>Once videos of the ants were collected, I used YOLO V8 to find video frames where ants were present.
I then saved a cropped image of the ant from the YOLO detection in a folder corresponding to that
ant’s identity.</p>

<p>Ant images are then put into the same convolutional neural network, known as a siamese 
network, that outputs a feature vector, or embedding, for each image. By finding the difference between embeddings of two images and taking the norm of that difference a distance is obtained. By comparing this
distance to a threshold, I was able to determine if ants were the same or different.</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/41e57b7c-5b99-40f1-9938-27a52a565ca7" /></p>
<p align="center">Model Summary</p>

<p>The model itself outputs a 128 element feature vector. To train it I used a loss function known as triplet loss. Training with triplet loss can be understood intuitively by giving the trainer 3 images at each training step, an anchor, a positive, and a negative. The anchor is an image of any ant, the positive is then a different picture of the same ant, and the negative is a picture of a different ant. During training, the model weights will be updated so that the distance between anchor and positive embeddings is smaller than the distance between anchor and negative embeddings.</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/9692bb97-9344-4ca4-9df5-629caa8e4fd8" /></p>
<p align="center">Triplet Loss Function</p>

<p align="center"><img src="https://github.com/oubrejames/antID/assets/46512429/5f83b33c-1a04-4203-a70d-9ffd9ba439ca" /></p>
<p align="center">Cost Function with Triplet Loss</p>

<p>Triplet loss makes this work because the distances between the anchor positive pair minus the anchor 
negative pair plus some margin must be less than zero. Because the difference between distances must 
be negative, the anchor negative distance must be larger than the anchor positive distance. The 
margin is then used to try and push the distances from the anchor to positive and negative embeddings 
further from each other. Because the max is taken between the difference of distances and zero, the 
loss will be zero when distances are separated by the defined margin.</p>

<p>The model was trained on 18,845 images of 45 different ants.</p>

<h2 id="results">Results</h2>

<p>To choose a threshold, I tested a range of thresholds between the average anchor-positive distance and
average anchor-negative distance. The threshold was chosen by picking the value that achieved the
highest accuracy.</p>

<p align="center"><img src=" https://github.com/oubrejames/antID/assets/46512429/973d7aff-4243-4023-a82a-7fe054b782b4" /></p>
<p align="center">Threshold Test</p>

<p>The model was tested on two different test sets. One contained 2,357 different images of 45 ants that the model had seen in training and the other had 3,687 images of 10 unseen ants. On the dataset of previously
seen ants, the model achieved a true positive rate of 95.21%, a true negative rate of 99.6% and an accuracy
of 97.3%. On the dataset of unseen ants, the model achieved a true positive rate of 80.67%, a true negative rate of 93.68% and an accuracy of 86.04%. Accuracy here is defined as the number of true positives plus the number of true negative over the total number of predictions.</p>


            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-08-10">10 Aug 2023</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#C++">C++</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Computer-Vision">Computer Vision</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Machine-Learning">Machine Learning</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#OpenCV">OpenCV</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#PyTorch">PyTorch</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/halo_auv/"> &laquo; Custom built ROV/AUV</a>
            
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Computer-Vision">Computer Vision (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ROS1-Mechatronics">ROS1 Mechatronics (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#SLAM">SLAM (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Controls">Controls (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#C++">C++ (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Circuit-Design">Circuit Design (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Power-Systems">Power Systems (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PCB-Design">PCB Design (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Digital-Logic">Digital Logic (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mechanical-Design">Mechanical Design (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Manufacturng">Manufacturng (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Arduino">Arduino (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sensors-&-Actuators">Sensors & Actuators (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#UR5-Robot-Arm">UR5 Robot Arm (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Manufacturing">Manufacturing (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Research">Research (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Intel-Realsense">Intel Realsense (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PincherX-100">PincherX 100 (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mobile-Manipulation-/-CoppeliaSim-/-PID-Control-/-Python">Mobile Manipulation / CoppeliaSim / PID Control / Python (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Dynamic-Systems">Dynamic Systems (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Simulation">Simulation (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter-Notebook">Jupyter Notebook (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ROS2">ROS2 (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Motion-Planning">Motion Planning (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Moveit">Moveit (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Emika-Franka-Robot-Arm">Emika Franka Robot Arm (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#C">C (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mechatronics">Mechatronics (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Embedded-Systems">Embedded Systems (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#I2C">I2C (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Electrical-Design">Electrical Design (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mavlink">Mavlink (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Machine-Learning">Machine Learning (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PyTorch">PyTorch (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Rahul Roy 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>


</body>
</html>
